# 字符串



与 C 语言的字符串对比

除了字符数组，还保存了字符串的长度和字符数组空余的长度

* 提高了获得字符串长度的性能
* 杜绝了缓冲区溢出，修改字符串时，首先会判断剩余空间是否满足，空间不够会先扩展空间
* 减少了修改字符串带来的内存重分配，Redis 的空间预分配和空间惰性释放
* 二进制安全，Redis 数组采用字节数组，写入时什么样，读取就什么样，没有C 语言字符串的限制，如 C 语言空字符表示字符串结束，而 Reds 中可以包含空字符，它用 len 判断字符串的结尾

空间预分配：Redis中的字符数组≠字符串的长度+1，它会多分配一些，多余的长度记录为 free，当字符串长度增加时不用再重新分配内存

空间惰性删除：Redis字符串长度减少时，不会立即释放多余的空间，而是修改 free 的值，下次增加就不用重新分配内存

# 链表



list 的值保存在链表中，发布订阅，慢查询，监视器等功能也都使用到了链表

Redis 链表的实现

* 双端
* 无环
* 带头指针和为指针
* 带链长计数
* 多态：链表可以保存多种类型的值



# 字典



Redis 对数据库的增删改查都是基于字典操作的

Redis 中字典的实现

Redis 中使用哈希表来实现字典(数组+链表)

数组

```
数组
数组大小
哈希表大小掩码(数组长度-1)
已有节点的数量
```



**哈希算法**

添加新元素

1. 根据 key 算出哈希值和索引值
2. 将键值对放在指定索引上
3. 冲突时，新节点添加到表头(因为没有尾指针)



**rehash**

键值对太多或太少时，需要进行 rehash，调整哈希表的大小

**负载因子**



**渐进式 rehash**



# 跳跃表

有序集合建的底层实现

平均复杂度=

最坏复杂度

平衡树



# 整数集合



















































































































